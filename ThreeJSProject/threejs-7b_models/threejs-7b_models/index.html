<html>

<head>
    <title>threejs - models</title>

    <style>
        body {
            margin: 0;
            overflow: hidden;
        }
    </style>
</head>

<body>

    <canvas id="myCanvas"></canvas>

    <script src="three.js"></script>
    <script src="GLTFLoader.js"></script>
    <script src="PointerLockControls.js"></script>
    <script>

        var renderer,
            scene,
            camera,
            myCanvas = document.getElementById('myCanvas');

        //RENDERER
        renderer = new THREE.WebGLRenderer({
            canvas: myCanvas,
            antialias: true
        });
        renderer.setClearColor(0x000000);
        renderer.setPixelRatio(window.devicePixelRatio);
        renderer.setSize(window.innerWidth, window.innerHeight);

        //CAMERA
        camera = new THREE.PerspectiveCamera(35, window.innerWidth / window.innerHeight, 0.1, 1000);
        camera.position.set(0, 10, 0);
        //SCENE
        scene = new THREE.Scene();

        var controls = new THREE.PointerLockControls(camera);
        myCanvas.addEventListener('click', function () {
            controls.lock();
        });

        var mesh;
        function setupMap(scene) {
            
            let loader = new THREE.TextureLoader();
            let geometry = new THREE.PlaneBufferGeometry( 250, 250);
            geometry.rotateX( - Math.PI / 2 );
            let material = new THREE.MeshLambertMaterial({ map: loader.load('ground.png'), side: THREE.DoubleSide });
            let ground = new THREE.Mesh(geometry, material);

            ground.position.set(0, 0, 0);
            scene.add(ground);
            
            let wall = setupWall(scene);
            wall.position.set(6, wall.position.y, 0);
            wall = setupWall(scene);
            wall.position.set(-6, wall.position.y, 0);

            loader = new THREE.GLTFLoader();
            loader.load('EmergencyBackupGenerator.glb', function (gltf) {
                mesh = gltf.scene;
                scene.add(mesh);
                mesh.position.z = -10;
            });
            /*
            loader.load('Chair1.glb', function (gltf) {
                mesh = gltf.scene;
                scene.add(mesh);
                mesh.children[0].material = new THREE.MeshPhysicalMaterial();
                mesh.position.x = -3;
                mesh.position.z = -10;
            });
            loader.load('table.glb', function (gltf) {
                mesh = gltf.scene;
                scene.add(mesh);
                mesh.children[0].material = new THREE.MeshPhysicalMaterial();
                mesh.position.x = -5;
                mesh.position.z = -10;
            });
            loader.load('SciFiMachine.glb', function (gltf) {
                mesh = gltf.scene;
                scene.add(mesh);
                mesh.children[0].material = new THREE.MeshPhysicalMaterial();
                mesh.position.set(0, 0, 0);
            }); */
        }
        function setupWall(scene, position)
        {
            let loader = new THREE.TextureLoader();
            let geometry = new THREE.BoxGeometry( 2, 20, 100 );
            geometry.position = position;
            let material = new THREE.MeshLambertMaterial({ map: loader.load('wall.png'), side: THREE.DoubleSide });
            let wall = new THREE.Mesh(geometry, material);

            //Ensures that the entire wall is on the ground.
            wall.position.y += wall.geometry.parameters.height / 2;
            scene.add(wall);

            return wall;
        }
        function setupLights(scene) {
            var light = new THREE.PointLight(0xffffff, 2);
            light.position.set(0, 20, 0);
            scene.add(light);

        }
        //RENDER LOOP
        setupMap(scene);
        setupLights(scene);
        render();

        var delta = 0;
        var prevTime = Date.now();

        function render() {

            renderer.render(scene, camera);
            requestAnimationFrame(render);
        }

    </script>
</body>

</html>